# Data Model: Embedding Pipeline

## Overview
Data structures for the embedding pipeline that extracts text from Docusaurus URLs, generates embeddings using Cohere, and stores them in Qdrant.

## Core Entities

### Document
Represents extracted text content from a single URL with metadata.

**Fields:**
- `url` (str): The source URL of the document
- `title` (str): The title of the page
- `content` (str): The cleaned text content
- `extraction_timestamp` (datetime): When the content was extracted
- `content_hash` (str): Hash of content to detect changes

**Relationships:**
- One-to-many with Chunks (one document can have multiple chunks)

### Chunk
Represents a segment of text content that will be converted to an embedding.

**Fields:**
- `chunk_id` (str): Unique identifier for the chunk
- `document_url` (str): Reference to the source document
- `content` (str): The text content of the chunk
- `chunk_index` (int): The position of this chunk in the original document
- `metadata` (dict): Additional metadata for the chunk
- `embedding_vector` (list[float]): The vector representation of the content

### Embedding
Vector representation of text content generated by Cohere with associated metadata.

**Fields:**
- `vector_id` (str): Unique identifier for the vector in Qdrant
- `vector` (list[float]): The embedding vector (typically 1024 dimensions for Cohere)
- `document_url` (str): Reference to the source document
- `chunk_id` (str): Reference to the source chunk
- `metadata` (dict): Additional metadata stored with the embedding
  - `url` (str): Source URL
  - `title` (str): Document title
  - `chunk_index` (int): Position in the original document
  - `content_preview` (str): First 100 characters of the chunk

## Qdrant Collection Schema

### Collection: `embeddings`
**Vector Configuration:**
- `vector_size`: 1024 (for Cohere embeddings)
- `distance`: Cosine (for semantic similarity)

**Payload Schema:**
- `url` (keyword): Source document URL
- `title` (text): Document title
- `chunk_index` (integer): Position of chunk in document
- `content_preview` (text): Short preview of content
- `created_at` (integer): Unix timestamp of creation

## Validation Rules

### Document Validation
- URL must be a valid HTTP/HTTPS URL
- Content must not be empty
- Extraction timestamp must be current

### Chunk Validation
- Content length must be within Cohere token limits
- Chunk index must be non-negative
- Document URL reference must be valid

### Embedding Validation
- Vector must have correct dimensions (1024 for Cohere)
- Vector values must be finite floats
- Metadata must contain required fields

## State Transitions

### Document States
1. `extracted` - Content has been crawled from URL
2. `cleaned` - Non-content elements have been removed
3. `chunked` - Content has been divided into processable chunks

### Chunk States
1. `ready` - Chunk is ready for embedding generation
2. `embedding` - Cohere API is processing the chunk
3. `embedded` - Embedding vector has been generated
4. `stored` - Vector has been saved to Qdrant

## Relationships

```
Document (1) -- (many) Chunk (1) -- (1) Embedding
```

Each document can be split into multiple chunks, each chunk generates one embedding, and each embedding is stored as a vector in Qdrant with associated metadata.